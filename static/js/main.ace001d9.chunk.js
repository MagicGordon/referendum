(this.webpackJsonpreferendum=this.webpackJsonpreferendum||[]).push([[0],{130:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(57),o=a.n(s),l=(a(67),a(1)),i=a.n(l),c=a(8),u=a(58),m=a(59),h=a(2),p=a(61),_=a(60),d=(a(69),a(12)),f=a(36),b=a.n(f),g=b()(10).pow(12),v=b()(200).mul(g),y=d.utils.format,E=y.formatNearAmount,k=y.parseNearAmount,C="dev-1641457721804-95400731314713",x=function(e){Object(p.a)(a,e);var t=Object(_.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).state={connected:!1,signedIn:!1,accountId:null,digitals:[],all_digitals:[],own_digital:"",target_digital:"",levelup_target:"",xref_balance:0,near_balance:0,lock_amount:0,lock_session:0,mint_amount:0,referend_meta:null,query_proposal_id:0,proposal_info:null,redeem_proposal_id:0,remove_proposal_id:0,action_proposal_id:0,action:"",memo:"",description:"",policy_type:"",session_id:0,start_offset_sec:"",lasts_sec:60,latest_block_time:0},n._digitalRefreshTimer=null,n.handleMintAmountChange=n.handleMintAmountChange.bind(Object(h.a)(n)),n.mintSubmit=n.mintSubmit.bind(Object(h.a)(n)),n.handleLockAmountChange=n.handleLockAmountChange.bind(Object(h.a)(n)),n.handleLockSessionChange=n.handleLockSessionChange.bind(Object(h.a)(n)),n.lockSubmit=n.lockSubmit.bind(Object(h.a)(n)),n.handleDescriptionChange=n.handleDescriptionChange.bind(Object(h.a)(n)),n.handlePolicyTypeChange=n.handlePolicyTypeChange.bind(Object(h.a)(n)),n.handleSessionIdChange=n.handleSessionIdChange.bind(Object(h.a)(n)),n.handleStartChange=n.handleStartChange.bind(Object(h.a)(n)),n.handleLastsChange=n.handleLastsChange.bind(Object(h.a)(n)),n.addProposalSubmit=n.addProposalSubmit.bind(Object(h.a)(n)),n.handleQueryProposalChange=n.handleQueryProposalChange.bind(Object(h.a)(n)),n.queryProposalSubmit=n.queryProposalSubmit.bind(Object(h.a)(n)),n.handleRedeemChange=n.handleRedeemChange.bind(Object(h.a)(n)),n.redeemSubmit=n.redeemSubmit.bind(Object(h.a)(n)),n.handleRemoveChange=n.handleRemoveChange.bind(Object(h.a)(n)),n.removeSubmit=n.removeSubmit.bind(Object(h.a)(n)),n.handleActionIdChange=n.handleActionIdChange.bind(Object(h.a)(n)),n.handleActionChange=n.handleActionChange.bind(Object(h.a)(n)),n.handleMemoChange=n.handleMemoChange.bind(Object(h.a)(n)),n.actionSubmit=n.actionSubmit.bind(Object(h.a)(n)),n._initNear().then((function(){n.setState({connected:!0,signedIn:!!n._accountId,accountId:n._accountId})})),n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){}},{key:"query_digitals",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._near.connection.provider.status();case 2:t=e.sent,a=new Date(t.sync_info.latest_block_time),this.setState({latest_block_time:parseInt(a.getTime()/1e3)});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccountStats",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,a,n,r,s,o,l=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._account.getAccountBalance();case 2:return t=e.sent,console.log(E(t.available)),e.next=6,this._near.connection.provider.status();case 6:return a=e.sent,console.log(a.sync_info.latest_block_time),n=new Date(a.sync_info.latest_block_time),r=parseInt(n.getTime()/1e3),console.log(r),s=null,e.prev=12,e.next=15,this._referendumContract.contract_metadata();case 15:s=e.sent,console.log(s),e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(12),e.next=23,this._referendumContract.modify_genesis_timestamp({genesis_timestamp_in_sec:r+30});case 23:window.location.reload();case 24:return e.next=26,this._xref_contract.ft_balance_of({account_id:this._accountId});case 26:o=e.sent,this.setState({referend_meta:s,near_balance:t.available,xref_balance:o}),this._digitalRefreshTimer=setInterval((function(){l.query_digitals()}),5e3);case 29:case"end":return e.stop()}}),e,this,[[12,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"_initNear",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"},a=new d.keyStores.BrowserLocalStorageKeyStore,e.next=4,d.connect(Object.assign({deps:{keyStore:a}},t));case 4:if(n=e.sent,this._keyStore=a,this._nearConfig=t,this._near=n,this._walletConnection=new d.WalletConnection(n,"dev-1641291247531-69951278398392"),this._accountId=this._walletConnection.getAccountId(),this._account=this._walletConnection.account(),!this._accountId){e.next=37;break}return this._referendumContract=new d.Contract(this._account,C,{viewMethods:["contract_metadata","get_proposal_info","get_proposals_in_session","get_proposal_ids_in_session","get_account_info","get_account_proposals_in_session","storage_balance_of"],changeMethods:["add_proposal","remove_proposal","redeem_near_in_expired_proposal","act_proposal","modify_genesis_timestamp","storage_deposit"]}),this._xref_contract=new d.Contract(this._account,"dev-1641291247531-69951278398392",{viewMethods:["ft_balance_of","storage_minimum_balance","storage_balance_of"],changeMethods:["storage_deposit","mint","ft_transfer_call","ft_transfer"]}),e.next=16,this._xref_contract.storage_balance_of({account_id:C});case 16:if(null!=e.sent){e.next=20;break}return e.next=20,this._xref_contract.storage_deposit({account_id:C},"200000000000000",k("0.01"));case 20:return e.next=22,this._referendumContract.storage_balance_of({account_id:this._accountId});case 22:if(null!=(r=e.sent)){e.next=26;break}return e.next=26,this._referendumContract.storage_deposit({account_id:this._accountId},"200000000000000",k("0.01"));case 26:return console.log("referendum_storage_balance_of",E(r.total)),e.next=29,this._xref_contract.storage_balance_of({account_id:this._accountId});case 29:if(null!=e.sent){e.next=33;break}return e.next=33,this._xref_contract.storage_deposit({account_id:this._accountId},"200000000000000",k("0.01"));case 33:return e.next=35,this.refreshAccountStats();case 35:e.next=38;break;case 37:console.log("not login");case 38:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"Referendum",e.next=3,this._walletConnection.requestSignIn(C,"Referendum");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._walletConnection.signOut(),this._accountId=null,this.setState({signedIn:!!this._accountId,accountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"action_mint",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._xref_contract.mint({account_id:this.state.accountId,amount:k(this.state.mint_amount)},v.toFixed(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleMintAmountChange",value:function(e){this.setState({mint_amount:e.target.value})}},{key:"mintSubmit",value:function(e){this.action_mint(),e.preventDefault()}},{key:"action_lock",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._xref_contract.ft_transfer_call({receiver_id:C,amount:k(this.state.lock_amount),msg:this.state.lock_session},"200000000000000",1);case 2:e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleLockAmountChange",value:function(e){this.setState({lock_amount:e.target.value})}},{key:"handleLockSessionChange",value:function(e){this.setState({lock_session:e.target.value})}},{key:"lockSubmit",value:function(e){this.action_lock(),e.preventDefault()}},{key:"addProposal",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._referendumContract.add_proposal({description:this.state.description,kind:"Vote",policy_type:this.state.policy_type,session_id:parseInt(this.state.session_id,10),start_offset_sec:parseInt(this.state.start_offset_sec,10),lasts_sec:parseInt(this.state.lasts_sec,10)},"200000000000000",this.state.referend_meta.lock_amount_per_proposal);case 2:t=e.sent,alert(t),window.location.reload();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleDescriptionChange",value:function(e){this.setState({description:e.target.value})}},{key:"handlePolicyTypeChange",value:function(e){this.setState({policy_type:e.target.value})}},{key:"handleSessionIdChange",value:function(e){this.setState({session_id:e.target.value})}},{key:"handleStartChange",value:function(e){this.setState({start_offset_sec:e.target.value})}},{key:"handleLastsChange",value:function(e){this.setState({lasts_sec:e.target.value})}},{key:"addProposalSubmit",value:function(e){this.addProposal(),e.preventDefault()}},{key:"query_proposal",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._referendumContract.get_proposal_info({proposal_id:parseInt(this.state.query_proposal_id,10)});case 2:t=e.sent,console.log(t),this.setState({proposal_info:t});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleQueryProposalChange",value:function(e){this.setState({query_proposal_id:e.target.value})}},{key:"queryProposalSubmit",value:function(e){this.query_proposal(),e.preventDefault()}},{key:"redeem_proposal",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._referendumContract.redeem_near_in_expired_proposal({id:parseInt(this.state.redeem_proposal_id,10)},"200000000000000");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleRedeemChange",value:function(e){this.setState({redeem_proposal_id:e.target.value})}},{key:"redeemSubmit",value:function(e){this.redeem_proposal(),e.preventDefault()}},{key:"remove_proposal",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._referendumContract.remove_proposal({id:parseInt(this.state.remove_proposal_id,10)},"200000000000000");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleRemoveChange",value:function(e){this.setState({remove_proposal_id:e.target.value})}},{key:"removeSubmit",value:function(e){this.remove_proposal(),e.preventDefault()}},{key:"action_proposal",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._referendumContract.act_proposal({id:parseInt(this.state.action_proposal_id,10),action:this.state.action,memo:this.state.memo},"200000000000000");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleActionIdChange",value:function(e){this.setState({action_proposal_id:e.target.value})}},{key:"handleActionChange",value:function(e){this.setState({action:e.target.value})}},{key:"handleMemoChange",value:function(e){this.setState({memo:e.target.value})}},{key:"actionSubmit",value:function(e){this.action_proposal(),e.preventDefault()}},{key:"render",value:function(){var e=this,t=this.state.connected?this.state.signedIn?r.a.createElement("div",null,r.a.createElement("div",{className:"float-right"},r.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"Log out")),r.a.createElement("h4",null,"Hello, ",r.a.createElement("span",{className:"font-weight-bold"},this.state.accountId),"!"),r.a.createElement("h4",null,"near balance: ",r.a.createElement("span",{className:"font-weight-bold"},E(this.state.near_balance))),r.a.createElement("h4",null,"xref balance: ",r.a.createElement("span",{className:"font-weight-bold"},E(this.state.xref_balance))),r.a.createElement("hr",null),r.a.createElement("h4",null,"threshold nonsense: ",r.a.createElement("span",{className:"font-weight-bold"},this.state.referend_meta.nonsense_threshold.numerator+"/"+this.state.referend_meta.nonsense_threshold.denominator)),r.a.createElement("h4",null,"threshold Relative minimum voting: ",r.a.createElement("span",{className:"font-weight-bold"},this.state.referend_meta.vote_policy[0].Relative[0].numerator+"/"+this.state.referend_meta.vote_policy[0].Relative[0].denominator)),r.a.createElement("h4",null,"threshold Relative judgement: ",r.a.createElement("span",{className:"font-weight-bold"},this.state.referend_meta.vote_policy[0].Relative[1].numerator+"/"+this.state.referend_meta.vote_policy[0].Relative[1].denominator)),r.a.createElement("h4",null,"threshold Absolute Pass: ",r.a.createElement("span",{className:"font-weight-bold"},this.state.referend_meta.vote_policy[1].Absolute[0].numerator+"/"+this.state.referend_meta.vote_policy[1].Absolute[0].denominator)),r.a.createElement("h4",null,"threshold Absolute Fail: ",r.a.createElement("span",{className:"font-weight-bold"},this.state.referend_meta.vote_policy[1].Absolute[1].numerator+"/"+this.state.referend_meta.vote_policy[1].Absolute[1].denominator)),r.a.createElement("h4",null,"lock_amount_per_proposal(Near): ",r.a.createElement("span",{className:"font-weight-bold"},E(this.state.referend_meta.lock_amount_per_proposal))),r.a.createElement("h4",null,"cur_total_ballot: ",r.a.createElement("span",{className:"font-weight-bold"},E(this.state.referend_meta.cur_total_ballot))),r.a.createElement("h4",null,"cur_lock_amount: ",r.a.createElement("span",{className:"font-weight-bold"},E(this.state.referend_meta.cur_lock_amount))),r.a.createElement("hr",null),r.a.createElement("h4",null,"latest_block_time: ",r.a.createElement("span",{className:"font-weight-bold"},this.state.latest_block_time)),r.a.createElement("h4",null,"offset_current_seesion_begin + 30: ",r.a.createElement("span",{className:"font-weight-bold"},0===this.state.latest_block_time?0:this.state.latest_block_time-this.state.referend_meta.genesis_timestamp_sec-3600*this.state.referend_meta.cur_session_id*24*30+30)),r.a.createElement("h4",null,"offset_current_seesion_begin + 60: ",r.a.createElement("span",{className:"font-weight-bold"},0===this.state.latest_block_time?0:this.state.latest_block_time-this.state.referend_meta.genesis_timestamp_sec-3600*this.state.referend_meta.cur_session_id*24*30+60)),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.mintSubmit},r.a.createElement("label",null," mint xref: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.mint_amount,onChange:function(t){e.handleMintAmountChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"mint"})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.lockSubmit},r.a.createElement("label",null," lock xref: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.lock_amount,onChange:function(t){e.handleLockAmountChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null," lock session: ",r.a.createElement("input",{type:"text",style:{marginLeft:"48px"},value:this.state.lock_session,onChange:function(t){e.handleLockSessionChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"lock"})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.addProposalSubmit},r.a.createElement("label",null," description: ",r.a.createElement("input",{type:"text",style:{marginLeft:"70px"},value:this.state.description,onChange:function(t){e.handleDescriptionChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null," policy_type: ",r.a.createElement("input",{type:"text",style:{marginLeft:"67px"},value:this.state.policy_type,onChange:function(t){e.handlePolicyTypeChange(t)}})," "),"Relative/Absolute",r.a.createElement("br",null),r.a.createElement("label",null," session_id: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.session_id,onChange:function(t){e.handleSessionIdChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null," start_offset_sec(s): ",r.a.createElement("input",{type:"text",style:{marginLeft:"11px"},value:this.state.start_offset_sec,onChange:function(t){e.handleStartChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null," duration(s): ",r.a.createElement("input",{type:"text",style:{marginLeft:"70px"},value:this.state.lasts_sec,onChange:function(t){e.handleLastsChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"addProposal"})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.queryProposalSubmit},r.a.createElement("label",null," query proposal id: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.query_proposal_id,onChange:function(t){e.handleQueryProposalChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null," proposal info: ",r.a.createElement("span",{className:"font-weight-bold"},JSON.stringify(this.state.proposal_info))," "),r.a.createElement("br",null),r.a.createElement("label",null," expire time: ",r.a.createElement("span",{className:"font-weight-bold"},null==this.state.proposal_info?0:this.state.referend_meta.genesis_timestamp_sec+3600*this.state.referend_meta.cur_session_id*24*30+this.state.proposal_info.start_offset_sec+this.state.proposal_info.lasts_sec)," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"query proposal"})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.redeemSubmit},r.a.createElement("label",null," redeem proposal id: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.redeem_proposal_id,onChange:function(t){e.handleRedeemChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"redeem"})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.removeSubmit},r.a.createElement("label",null," remove proposal id: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.remove_proposal_id,onChange:function(t){e.handleRemoveChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"remove"})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.actionSubmit},r.a.createElement("label",null," id: ",r.a.createElement("input",{type:"text",style:{marginLeft:"105px"},value:this.state.action_proposal_id,onChange:function(t){e.handleActionIdChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null," action: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.action,onChange:function(t){e.handleActionChange(t)}})," "),"VoteApprove/VoteReject/VoteNonsense",r.a.createElement("br",null),r.a.createElement("label",null," memo: ",r.a.createElement("input",{type:"text",style:{marginLeft:"74px"},value:this.state.memo,onChange:function(t){e.handleMemoChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"action"})),r.a.createElement("hr",null)):r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.requestSignIn()}},"Log in with NEAR Wallet")):r.a.createElement("div",null,"Connecting... ",r.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return r.a.createElement("div",{className:"px-5"},r.a.createElement("h1",null,"Referendum"),t)}}]),a}(r.a.Component);o.a.render(r.a.createElement(x,null),document.getElementById("root"))},62:function(e,t,a){e.exports=a(130)},67:function(e,t,a){},69:function(e,t,a){},75:function(e,t){},85:function(e,t){}},[[62,1,2]]]);
//# sourceMappingURL=main.ace001d9.chunk.js.map