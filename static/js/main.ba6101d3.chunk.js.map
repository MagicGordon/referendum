{"version":3,"sources":["App.js","index.js"],"names":["TGas","Big","pow","BoatOfGas","mul","ContractName","App","props","state","connected","signedIn","accountId","digitals","all_digitals","own_digital","target_digital","levelup_target","_digitalRefreshTimer","handleLevelUpTargetChange","bind","levelupSubmit","handleOwnChange","handleTargetChange","handleSubmit","_initNear","then","setState","_accountId","a","this","_contract","get_digitals","get_all_digitals","clearInterval","nearConfig","networkId","nodeUrl","contractName","walletUrl","keyStore","nearAPI","BrowserLocalStorageKeyStore","Object","assign","deps","near","_keyStore","_nearConfig","_near","_walletConnection","getAccountId","_account","account","viewMethods","changeMethods","refreshAccountStats","requestSignIn","signOut","add_first","res","alert","window","location","reload","pk","parseInt","event","target","value","pk_action","preventDefault","levelup","digital","toFixed","action_levelup","content","className","onClick","logOut","onSubmit","type","style","marginLeft","onChange","length","map","key","addFirst","whiteSpace","owner","level","marginBottom","role","aria-hidden","React","Component","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.ba6101d3.chunk.js","sourcesContent":["import \"./App.css\";\nimport React from 'react';\n// import BN from 'bn.js';\nimport * as nearAPI from 'near-api-js'\nimport Big from 'big.js';\n\nconst TGas = Big(10).pow(12);\nconst BoatOfGas = Big(200).mul(TGas);\n\n// const ContractName = 'dev-1629962930296-20948195726082';\n// const ContractName = 'dev-1630033758756-26263481745179';\nconst ContractName = 'dev-1630146349634-18193940589410';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      connected: false,\n      signedIn: false,\n      accountId: null,\n      digitals: [],\n      all_digitals: [],\n      own_digital: \"\",\n      target_digital: \"\",\n      levelup_target:\"\"\n    };\n\n    this._digitalRefreshTimer = null;\n\n\n    this.handleLevelUpTargetChange = this.handleLevelUpTargetChange.bind(this);\n    this.levelupSubmit = this.levelupSubmit.bind(this);\n\n    this.handleOwnChange = this.handleOwnChange.bind(this);\n    this.handleTargetChange = this.handleTargetChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n\n    this._initNear().then(() => {\n      this.setState({\n        connected: true,\n        signedIn: !!this._accountId,\n        accountId: this._accountId,\n      });\n    });\n  }\n\n  componentDidMount() {\n  }\n\n\n  async query_digitals() {\n    let digitals = await this._contract.get_digitals({ accountId: this._accountId })\n    let all_digitals = await this._contract.get_all_digitals({ accountId: this._accountId })\n    this.setState({\n      digitals: digitals,\n      all_digitals: all_digitals,\n    })\n  }\n\n  async refreshAccountStats() {\n    let digitals = await this._contract.get_digitals({ accountId: this._accountId });\n    let all_digitals = await this._contract.get_all_digitals({ accountId: this._accountId })\n    if (this._digitalRefreshTimer) {\n      clearInterval(this._digitalRefreshTimer);\n      this._digitalRefreshTimer = null;\n    }\n\n    this.setState({\n      digitals: digitals,\n      all_digitals: all_digitals,\n    });\n\n    // this._digitalRefreshTimer = setInterval(() => {\n    //   this.query_digitals();\n    // }, 100);\n  }\n\n\n\n  async _initNear() {\n    const nearConfig = {\n      networkId: 'default',\n      nodeUrl: 'https://rpc.testnet.near.org',\n      contractName: ContractName,\n      walletUrl: 'https://wallet.testnet.near.org',\n    };\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(Object.assign({ deps: { keyStore } }, nearConfig));\n    this._keyStore = keyStore;\n    this._nearConfig = nearConfig;\n    this._near = near;\n\n    this._walletConnection = new nearAPI.WalletConnection(near, ContractName);\n    this._accountId = this._walletConnection.getAccountId();\n\n    this._account = this._walletConnection.account();\n    this._contract = new nearAPI.Contract(this._account, ContractName, {\n      viewMethods: ['get_digitals', 'next_digital', 'get_all_digitals'],\n      changeMethods: ['add_first', 'pk', 'levelup'],\n    });\n    if (this._accountId) {\n      await this.refreshAccountStats();\n    }\n  }\n\n\n  async requestSignIn() {\n    const appTitle = 'Digital War';\n    await this._walletConnection.requestSignIn(\n      ContractName,\n      appTitle\n    )\n  }\n\n  async logOut() {\n    this._walletConnection.signOut();\n    this._accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      accountId: this._accountId,\n    })\n  }\n\n  async addFirst() {\n    let res = await this._contract.add_first();\n    alert(res);\n    window.location.reload()\n  }\n\n  async pk_action(){\n    let res = await this._contract.pk({own_digital: parseInt(this.state.own_digital, 10), target_digital: parseInt(this.state.target_digital, 10)})\n    // alert('own_digital: ' + this.state.own_digital  + ',target_digital: ' + this.state.target_digital);\n    alert(res)\n    window.location.reload()\n  }\n\n  handleOwnChange(event) {    this.setState({own_digital: event.target.value});  }\n  handleTargetChange(event) {    this.setState({target_digital: event.target.value});  }\n  handleSubmit(event) {\n    this.pk_action();\n    event.preventDefault();\n  }\n\n  async action_levelup(){\n    let res = await this._contract.levelup({digital: parseInt(this.state.levelup_target, 10)}, BoatOfGas.toFixed(0), Big(10000000000).mul(TGas).toFixed(0))\n    // alert('own_digital: ' + this.state.own_digital  + ',target_digital: ' + this.state.target_digital);\n    alert(res)\n    window.location.reload()\n  }\n\n  handleLevelUpTargetChange(event) {    this.setState({levelup_target: event.target.value});  }\n\n  levelupSubmit(event) {\n    this.action_levelup();\n    event.preventDefault();\n  }\n\n\n  render() {\n    const content = !this.state.connected ? (\n      <div>Connecting... <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span></div>\n    ) : (this.state.signedIn ? (\n      <div>\n        <div className=\"float-right\">\n          <button\n            className=\"btn btn-outline-secondary\"\n            onClick={() => this.logOut()}>Log out</button>\n        </div>\n        <h4>Hello, <span className=\"font-weight-bold\">{this.state.accountId}</span>!</h4>\n\n        <form onSubmit={this.levelupSubmit}>\n          <label> digital: <input type=\"text\" style={{marginLeft:\"74px\"}} value={this.state.levelup_target} onChange={(event) => {this.handleLevelUpTargetChange(event)}} /> </label><br/>\n          <input type=\"submit\" value=\"levelup\" />\n        </form>\n        <hr></hr>\n        <form onSubmit={this.handleSubmit}>\n          <label> challenger: <input type=\"text\" style={{marginLeft:\"44px\"}} value={this.state.own_digital} onChange={(event) => {this.handleOwnChange(event)}} /> </label><br/>\n          <label> challenge target: <input type=\"text\" value={this.state.target_digital} onChange={(event) => {this.handleTargetChange(event)}} /> </label><br/>\n          <input type=\"submit\" value=\"challenge\" />\n        </form>\n        <hr></hr>\n        <div>\n          Your digitals:\n          <ul>\n            {this.state.digitals.length !== 0 ?\n              (this.state.digitals.map(value => <li key={value}> {value}</li>)) :\n              (<button className=\"btn btn-primary\" onClick={() => this.addFirst()}>Get first digital</button>)}\n          </ul>\n        </div>\n        <hr></hr>\n        <div>\n          Digital Pool:\n          <ul>\n            {this.state.all_digitals.length !== 0 ?\n              (this.state.all_digitals.map(value => <li style={{whiteSpace: \"pre\"}} key={value.digital}> Digital：{value.digital}       Owner：{value.owner}       Level：{value.level}</li>)) :\n              (<div>暂无</div>)}\n          </ul>\n        </div>\n      </div>\n    ) : (\n      <div style={{ marginBottom: \"10px\" }}>\n        <button\n          className=\"btn btn-primary\"\n          onClick={() => this.requestSignIn()}>Log in with NEAR Wallet</button>\n      </div>\n    ));\n    return (\n      <div className=\"px-5\">\n        <h1>Referendum</h1>\n        {content}\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}